on_monthly_pulse = {
    effect = {
        # update stat month monthly
        update_stat_month = yes

        every_character_in_exile_pool = {
            limit = {
                popularity <= -100
            }
            kill_character = yes
        }

        every_character_in_jail = { # Music too loud? Right to jail. Right away. Driving too fast? Jail. Slow? Jail. You undercook fish? Believe it or not, jail.
            save_scope_as = prisoner_scope
            change_variable = { name = prison_time_var subtract = 1 }
            if = {
                limit = {
                    NOT = {
                        exists = var:prison_country
                    }
                }
                kill_character = yes
            }
            else_if = {
                limit = {
                    exists = var:prison_country
                    var:prison_time_var <= 0
                }
                free_character_from_void = yes
                owner ?= {
                    post_notification = prisoner_out_of_jail
                }
                remove_variable = prison_country
                remove_variable = prison_time_var
            }
        }

        if = {
            limit = {
                year < 1930
                NOT = { has_global_variable = germany_formed }
                c:GER ?= { is_country_alive = yes }
            }
            set_global_variable = germany_formed
        }

        # Used to keep track of Council Republics for the purpose of the Red Scare.
        # Our thanks to Brute for reporting this.
        clear_global_variable_list = aes_country_list
        every_country = {
            limit = {
                has_law = law_type:law_council_republic
                country_rank > rank_value:minor_power
            }
            add_to_global_variable_list = {
                name = aes_country_list
                target = THIS
            }
        }

        if = {
            limit = {
                exists = global_var:krakatoa_temperature_drop
                exists = global_var:krakatoa_temperature_recovery_rate
            }
            change_global_variable = {
                name = krakatoa_temperature_drop
                subtract = {
                    value = global_var:krakatoa_temperature_recovery_rate
                }
            }
        }
    }
}

on_monthly_pulse_country = {
    events = {
        communism.8 # Red Army
        peoples_springtime.1
        opium_wars.1
        native_resettlement.1
        meiji.13
        bic_breakup.1
        dreyfus.1
        dei_breakup.1
        alk_breakup.1
        poland_events.3 # Polish Unification
        colonial_administration_events.2 # African Colony Radicals
        caudillo.1
        sa_migration.5
        amazonas.1 # Taming Amazonia
        paraguay.11 # Paraguay War
        acw_events.9 # CSA victory event
        persia_events.5 # Persian slave liberation event
        treaty_of_london_events.1 # Treaty of London initiation event

        # Exile Agitators Events
        yeet_agitator_events.1
        yeet_agitator_events.2
        yeet_agitator_events.3

        # Comte
        positivism.1

        # Milyutin
        caucasuswar.5

        # Phool Walon Ki Sair
        india_events.8

        # Princely State Creation
        princely_state_creation.1
        princely_state_creation.2
        princely_state_creation.3
        princely_state_creation.4
        princely_state_creation.5

        # Set Hierarchy Events
        set_hierarchy_event.1 # Sets British Indian Caste System
        set_hierarchy_event.2 # Replaces British Indian Caste System with Default
    }

    effect = {
        # initializa variables for only once
        initialize_stat_variables = yes
        # track last year GDP growth rate
        calculte_last_year_gdp_growth_rate = yes
        # track annual projected GDP growth rate
        calculate_annual_projected_gdp_growth_rate = yes

        trigger_event = { id = unable_to_enact.1 }

        # British Monarchy
        if = {
            limit = {
                c:GBR ?= this
                game_date >= 1841.11.09
                ruler ?= {
                    has_template = gbr_queen_victoria_template
                }
                NOT = {
                    has_variable = edward_vii_heir_var
                }
            }
            create_character = {
                template = gbr_albert_edward_template
                heir = yes
            }
            set_variable = edward_vii_heir_var
        }
        if = {
            limit = {
                c:GBR ?= this
                game_date >= 1865.06.03
                ruler ?= {
                    has_template = gbr_albert_edward_template
                }
                NOT = {
                    exists = heir
                }
                NOT = {
                    has_variable = george_v_heir_var
                }
            }
            create_character = {
                template = gbr_george_v_template
                heir = yes
            }
            set_variable = george_v_heir_var
        }
        if = {
            limit = {
                c:GBR ?= this
                game_date >= 1910.5.06
                ruler ?= {
                    has_template = gbr_albert_edward_template
                }
                heir = {
                    has_template = gbr_george_v_template
                }
                NOT = {
                has_variable = george_v_ruler_var
                }
            }
            trigger_event = { id = britain_monarchy.1 popup = yes }
        }

        # Sweden Monarchy event
        if = {
            limit = {
                c:SWE ?= this
                game_date >= 1859.6.29
                ruler ?= {
                    has_template = swe_oscar_bernadotte_template
                }
                heir = {
                    has_template = swe_charles_bernadotte_template
                }
            }
            trigger_event = { id = sweden_monarchy.2 popup = yes }
        }
        if = {
            limit = {
                c:SWE ?= this
                game_date >= 1859.6.29
                NOT = {
                    ruler ?= {
                        has_template = swe_oscar_bernadotte_template
                    }
                    has_variable = charles_xv_ruler_var
                }
            }
            set_variable = charles_xv_ruler_var
            create_character = {
                template = swe_oscar_ii_bernadotte_template
                heir = yes
                is_admiral = yes
            }
            if = {
                limit = {
                    any_scope_character = {
                        has_template = swe_charles_bernadotte_template
                    }
                }
                random_scope_character = {
                    limit = {
                        has_template = swe_charles_bernadotte_template
                    }
                    add_trait = cancer
                }
            }
        }

        if = {
            limit = {
                c:SWE ?= this
                game_date >= 1872.9.29
                any_scope_character = {
                    is_ruler = yes
                    has_template = swe_charles_bernadotte_template
                }
                any_scope_character = {
                    is_heir = yes
                    has_template = swe_oscar_ii_bernadotte_template
                }
            }
            trigger_event = { id = sweden_monarchy.3 popup = yes }
        }

        if = {
            limit = {
                c:SWE ?= this
                game_date >= 1872.9.29
                any_scope_character = {
                       is_ruler = yes
                       has_template = swe_oscar_ii_bernadotte_template
                }
                NOT = {
                       has_variable = oscar_ii_ruler_var
                }
            }
            create_character = {
                template = swe_gustaf_v_bernadotte_template
                heir = yes
            }
            set_variable = oscar_ii_ruler_var
        }

        if = {
            limit = {
                c:GBR ?= this
                game_date >= 1850.1.1
                NOT = {
                has_variable = nightingale_var
                }
            }
            create_character = {
                template = GBR_florence_nightingale
                on_created = {
                    if = {
                        limit = { is_in_exile_pool = no }
                        exile_character = yes
                    }
                }
            }
            set_variable = nightingale_var
        }

        # Japan
        if = {
            limit = {
                c:JAP ?= this
                has_variable = meiji_restoration_complete
                has_law = law_type:law_monarchy
            }
            if = {
                limit = {
                    year >= 1852
                    NOT = { has_variable = heir_meiji_spawned }
                    ruler ?= {
                        has_template = JAP_komei_yamato
                    }
                    NOT = { exists = heir }
                }
                create_character = {
                    template = JAP_meiji_yamato
                }
                set_variable = heir_meiji_spawned
            }
            else_if = {
                limit = {
                    year >= 1879
                    NOT = { has_variable = heir_taisho_spawned }
                    ruler ?= {
                        has_template = JAP_meiji_yamato
                    }
                    NOT = { exists = heir }
                }
                create_character = {
                    template = JAP_taisho_yamato
                }
                set_variable = heir_taisho_spawned
            }
            else_if = {
                limit = {
                    year >= 1901
                    NOT = { has_variable = heir_showa_spawned }
                    ruler ?= {
                        has_template = JAP_taisho_yamato
                    }
                    NOT = { exists = heir }
                }
                create_character = {
                    template = JAP_showa_yamato
                }
                set_variable = heir_showa_spawned
            }
        }

        ### This is how we give objectives to AI countries
        if = {
            limit = {
                has_journal_entry = je_great_game_control
                has_dlc_feature = ep1_content
                is_player = no
            }
            if = {
                limit = {
                    c:RUS ?= this
                }
                ### Generic Objectives
                if = {
                    limit = {
                        NOT = {
                            has_variable = je_tibet_expedition_ai_var
                        }
                        has_variable = tibet_has_started
                        NOT = { has_global_variable = tibet_expedition_completed }
                        has_interest_marker_in_region = region_himalayas
                    }
                    set_variable = je_tibet_expedition_ai_var
                    add_journal_entry = {
                        type = je_tibet_expedition
                    }
                }
                if = {
                    limit = {
                        NOT = {
                            has_variable = je_consolidate_afghanistan_objective_ai_var
                        }
                        has_interest_marker_in_region = region_persia
                        exists = c:AFG
                    }
                    set_variable = je_consolidate_afghanistan_objective_ai_var
                    add_journal_entry = {
                        type = je_consolidate_afghanistan_objective
                    }
                }
                if = {
                    limit = {
                        NOT = {
                            has_variable = je_maintain_afghan_protectorate_ai_var
                        }
                        NOT = {
                            has_global_variable = gg_afghanistan_protectorate_done
                        }
                        has_interest_marker_in_region = region_persia
                    }
                    set_variable = je_maintain_afghan_protectorate_ai_var
                    add_journal_entry = {
                        type = je_maintain_afghan_protectorate
                    }
                }
                if = {
                    limit = {
                        NOT = {
                            has_variable = je_secure_influence_over_persia_ai_var
                        }
                        has_interest_marker_in_region = region_persia
                    }
                    set_variable = je_secure_influence_over_persia_ai_var
                    add_journal_entry = {
                        type = je_secure_influence_over_persia
                    }
                }

                ### Specific Objectives
                if = {
                    limit = {
                        NOT = {
                            has_variable = je_secure_persian_border_ai_var
                        }
                        exists = c:CIR
                    }
                    set_variable = je_secure_persian_border_ai_var
                    add_journal_entry = {
                        type = je_secure_persian_border
                    }
                }
                if = {
                    limit = {
                        NOT = {
                            has_variable = je_pacify_kazakh_steppes_ai_var
                        }
                        has_journal_entry = je_pacify_the_steppes
                    }
                    set_variable = je_pacify_kazakh_steppes_ai_var
                    add_journal_entry = {
                        type = je_pacify_kazakh_steppes
                    }
                }
                if = {
                    limit = {
                        NOT = {
                            has_variable = je_codify_chinese_border_ai_var
                        }
                        has_technology_researched = nationalism
                    }
                    set_variable = je_codify_chinese_border_ai_var
                    add_journal_entry = {
                        type = je_codify_chinese_border
                    }
                }
                if = {
                    limit = {
                        NOT = {
                            has_variable = je_consolidate_central_asia_ai_var
                        }
                        has_technology_researched = nationalism
                    }
                    set_variable = je_consolidate_central_asia_ai_var
                    add_journal_entry = {
                        type = je_consolidate_central_asia
                    }
                }
                if = {
                    limit = {
                        NOT = {
                            has_variable = je_chinese_concessions_ai_var
                        }
                        has_technology_researched = railways
                        any_scope_state = {
                            OR = {
                                state_region = s:STATE_OUTER_MANCHURIA
                                state_region = s:STATE_AMUR
                            }
                            is_incorporated = yes
                        }
                    }
                    set_variable = je_chinese_concessions_ai_var
                    add_journal_entry = {
                        type = je_chinese_concessions
                    }
                }
                if = {
                    limit = {
                        NOT = {
                            has_variable = je_acquire_korean_protectorate_ai_var
                        }
                        any_neighbouring_state = {
                            owner = c:KOR
                            is_incorporated = yes
                        }
                        c:KOR ?= {
                            is_country_type = unrecognized
                        }
                    }
                    set_variable = je_acquire_korean_protectorate_ai_var
                    add_journal_entry = {
                        type = je_acquire_korean_protectorate
                    }
                }
            }

            if = {
                limit = {
                    c:GBR ?= this
                    has_journal_entry = je_great_game_control
                }
                ### Generic Objectives
                if = {
                    limit = {
                        NOT = {
                            has_variable = je_tibet_expedition_ai_var
                        }
                        has_variable = tibet_has_started
                        NOT = { has_global_variable = tibet_expedition_completed }
                        has_interest_marker_in_region = region_himalayas
                    }
                    set_variable = je_tibet_expedition_ai_var
                    add_journal_entry = {
                        type = je_tibet_expedition
                    }
                }
                if = {
                    limit = {
                        NOT = {
                            has_variable = je_consolidate_afghanistan_objective_ai_var
                        }
                        has_interest_marker_in_region = region_persia
                        exists = c:AFG
                    }
                    set_variable = je_consolidate_afghanistan_objective_ai_var
                    add_journal_entry = {
                        type = je_consolidate_afghanistan_objective
                    }
                }
                if = {
                    limit = {
                        NOT = {
                            has_variable = je_maintain_afghan_protectorate_ai_var
                        }
                        NOT = {
                            has_global_variable = gg_afghanistan_protectorate_done
                        }
                        has_interest_marker_in_region = region_persia
                    }
                    set_variable = je_maintain_afghan_protectorate_ai_var
                    add_journal_entry = {
                        type = je_maintain_afghan_protectorate
                    }
                }
                if = {
                    limit = {
                        NOT = {
                            has_variable = je_secure_influence_over_persia_ai_var
                        }
                        has_interest_marker_in_region = region_persia
                    }
                    set_variable = je_secure_influence_over_persia_ai_var
                    add_journal_entry = {
                        type = je_secure_influence_over_persia
                    }
                }
                ### Specific Objectives
                if = {
                    limit = {
                        NOT = {
                            has_variable = je_disrupt_russian_caucasus_ai_var
                        }
                        exists = c:CIR
                    }
                    set_variable = je_disrupt_russian_caucasus_ai_var
                    add_journal_entry = {
                        type = je_disrupt_russian_caucasus
                    }
                }
                if = {
                    limit = {
                        NOT = {
                            has_variable = je_counter_russian_pacific_influence_ai_var
                        }
                        c:RUS ?= {
                            any_scope_state = {
                                region = sr:region_manchuria
                                OR = {
                                    any_scope_building = {
                                        is_building_type = building_port
                                        level >= 5
                                    }
                                    any_scope_building = {
                                        is_building_type = building_naval_base
                                        level >= 15
                                    }
                                }
                            }
                        }
                    }
                    set_variable = je_counter_russian_pacific_influence_ai_var
                    add_journal_entry = {
                        type = je_counter_russian_pacific_influence
                    }
                }
                if = {
                    limit = {
                        NOT = {
                            has_variable = je_consolidate_british_india_ai_var
                        }
                        c:BIC ?= {
                            is_subject_of = c:GBR
                        }
                    }
                    set_variable = je_consolidate_british_india_ai_var
                    add_journal_entry = {
                        type = je_consolidate_british_india
                    }
                }
                if = {
                    limit = {
                        NOT = {
                            has_variable = je_pamir_expedition_objective_ai_var
                        }
                        c:RUS ?= {
                            OR = {
                                any_scope_state = {
                                    state_region = s:STATE_TAJIKISTAN
                                }
                                any_subject_or_below = {
                                    any_scope_state = {
                                        state_region = s:STATE_TAJIKISTAN
                                    }
                                }
                            }
                        }
                        NOT = {
                            has_variable = dismissed_pamir_expedition
                        }
                    }
                    set_variable = je_pamir_expedition_objective_ai_var
                    add_journal_entry = {
                        type = je_pamir_expedition_objective
                    }
                }
            }

            if = {
                limit = {
                    is_afghan_nation = yes
                    has_journal_entry = je_great_game_control
                }
                ### Generic Objectives
                if = {
                    limit = {
                        NOT = {
                            has_variable = je_achieve_sovereignty_ai_var
                        }
                        is_country_type = unrecognized
                    }
                    set_variable = je_achieve_sovereignty_ai_var
                    add_journal_entry = {
                        type = je_achieve_sovereignty
                    }
                }
                ### Specific Objectives
                if = {
                    limit = {
                        NOT = {
                            has_variable = je_unify_afghanistan_objective_ai_var
                        }
                    }
                    set_variable = je_unify_afghanistan_objective_ai_var
                    add_journal_entry = {
                        type = je_unify_afghanistan_objective
                    }
                }
            }

            if = {
                limit = {
                    c:PER ?= this
                    has_journal_entry = je_great_game_control
                }
                ### Generic Objectives
                if = {
                    limit = {
                        NOT = {
                            has_variable = je_achieve_sovereignty_ai_var
                        }
                        is_country_type = unrecognized
                    }
                    set_variable = je_achieve_sovereignty_ai_var
                    add_journal_entry = {
                        type = je_achieve_sovereignty
                    }
                }
                ### Specific Objectives
                if = {
                    limit = {
                        NOT = {
                            has_variable = je_consolidate_persia_ai_var
                        }
                    }
                    set_variable = je_consolidate_persia_ai_var
                    add_journal_entry = {
                        type = je_consolidate_persia
                    }
                }
            }
        }

        # TODO: Move these to tag-specific pulses
        if = {
            limit = {
                c:FRA ?= this
                c:FRA ?= {
                    OR = {
                        has_modifier = modifier_haitian_independence_payments_1
                        has_modifier = modifier_haitian_independence_payments_2
                        has_modifier = modifier_haitian_independence_payments_3
                        has_modifier = modifier_haitian_independence_payments_4
                    }
                }
                NOT = { exists = c:HAI }
            }
            c:FRA = {
                if = {
                    limit = {
                        has_modifier = modifier_haitian_independence_payments_1
                    }
                    remove_modifier = modifier_haitian_independence_payments_1
                }
                if = {
                    limit = {
                        has_modifier = modifier_haitian_independence_payments_2
                    }
                    remove_modifier = modifier_haitian_independence_payments_2
                }
                if = {
                    limit = {
                        has_modifier = modifier_haitian_independence_payments_3
                    }
                    remove_modifier = modifier_haitian_independence_payments_3
                }
                if = {
                    limit = {
                        has_modifier = modifier_haitian_independence_payments_4
                    }
                    remove_modifier = modifier_haitian_independence_payments_4
                }
            }
        }
        if = { # Removes the Berar lease modifier if no longer relevant
            limit = {
                c:BIC ?= this
                c:BIC ?= {
                    has_modifier = lease_of_berar_costs
                }
                OR = {
                    NOT = { exists = c:HYD }
                    c:BIC ?= {
                        has_war_with = c:HYD
                    }
                    c:BIC = {
                        NOT = {
                            any_scope_state = {
                                state_region = s:STATE_CENTRAL_PROVINCES
                            }
                        }
                    }
                }
            }
            c:BIC ?= {
                remove_modifier = lease_of_berar_costs
            }
            c:HYD ?= {
                remove_modifier = lease_of_berar_income
            }
        }
        if = { #Exists to make sure independent Perus get this ASAP.
            limit = {
                OR = {
                    c:NPU ?= this
                    c:SPU ?= this
                }
                is_subject = no
                NOT = {
                    has_variable = peru_has_claims
                }
                OR = {
                    AND = { #SPU is either dead or a puppet, will not fire if it is independent.
                        c:NPU ?= this
                        OR = {
                            NOT = {
                                exists = c:SPU
                            }
                            c:SPU ?= { is_subject = yes }
                        }
                    }
                    AND = {
                        c:SPU ?= this
                        OR = {
                            NOT = {
                                exists = c:SPU
                            }
                            c:NPU ?= { is_subject = yes }
                        }
                    }
                }
            }
            trigger_event = { id = peru_bolivia_events.8 days = 0 popup = yes }
        }


        if = {
            limit = {
                NOT = {
                    has_variable = cant_touch_this_achievement_possible
                }
                any_country = {
                    NOT = {
                       THIS = ROOT
                    }
                    ROOT = {
                        "gdp_ownership_ratio(prev)" > 0.10
                    }
                }
            }
            set_variable = cant_touch_this_achievement_possible
        }

        if = {
            limit = {
                is_country_type = colonial # The colonial country type, for now, is only used for colonies whilst they are subjects of another power
                is_subject = no
            }
            set_country_type = recognized
        }

        if = { # Creates Petrograd
            limit = {
                country_has_primary_culture = cu:russian
                has_technology_researched = nationalism
                NOT = { has_law = law_type:law_council_republic }

                OR = {
                    any_rival_country = {
                        any_primary_culture = {
                            has_discrimination_trait = german_speaking
                        }
                    }
                    any_rivaling_country = {
                        any_primary_culture = {
                            has_discrimination_trait = german_speaking
                        }
                    }
                }
                any_scope_state = {
                    state_region = s:STATE_INGRIA
                }
                NOT = {
                    has_variable = petrograd_var
                }
            }
            set_variable = petrograd_var
            random_scope_state = {
                limit = {
                    state_region = s:STATE_INGRIA
                }
                if = {
                    limit = {
                        has_global_variable = lenin_spawn

                        owner = {
                            country_has_primary_culture = cu:russian
                            has_law = law_type:law_council_republic
                        }
                    }

                    set_hub_name = {
                        type = city
                        name = HUB_NAME_STATE_INGRIA_city_russian_sov # St. Petersburg only becomes Leningrad if Lenin has been around to be a namesake
                    }
                }
            }
        }

        # for Venice, Vidi, Vici Achievement
        if = {
            limit = {
                is_player = yes
                AND = {
                    c:VEN ?= THIS
                    NOT = { has_variable = venice_vidi_vici_achievement_happened }
                    any_scope_building = {
                        is_building_type = building_trade_center
                    }
                }
            }
            set_variable = { name = ven_trade_center_count_var value = "root.country_has_building_group_levels(bg_trade)" } # sets ven_trade_center_count_var value to the total building levels of trade centers in the country
        }
        if = { # checks if ven_trade_center_count_var is higher than the total building levels of trade centers in the country
            limit = {
                is_player = yes
                exists = c:VEN
                c:VEN ?= {
                    has_variable = ven_trade_center_count_var
                }
                NOT = {
                    any_country = {
                        country_has_building_group_levels = {
                            type = bg_trade
                            value > root.var:ven_trade_center_count_var
                        }
                    }
                }
            }
            c:VEN ?= {
                set_variable = venice_vidi_vici_achievement_happened
                remove_variable = ven_trade_center_count_var
            }
        }
        # for Swiss Bank Account Achievement
        if = {
            limit = {
                is_player = yes
                c:SWI ?= THIS
                NOT = {
                    has_variable = swiss_bank_account_happened
                }
                any_scope_treaty = {
                    any_scope_article = {
                        has_type = money_transfer
                    }
                }
            }
            ROOT = {
                set_variable = { name = swiss_bank_account_var value = 0 }
                change_variable = {
                    name = swiss_bank_account_var
                    add = {
                        value = gdp
                        divide = 10
                    }
                }
               }
               if = {
                limit = {
                    transfer_money_gross_income >= root.var:swiss_bank_account_var
                }
                set_variable = swiss_bank_account_happened
            }
        }
        # for All Quiet on the Western Front Achievement
        if = {
            limit = {
                is_player = yes
                NOT = {
                    has_variable = all_quiet_on_the_western_front_happened
                }
                is_at_war = yes
                any_scope_war = {
                    any_scope_front = {
                        num_front_casualties = {
                            target = root
                            value > 1000000
                        }
                    }
                }
            }
            set_variable = all_quiet_on_the_western_front_happened
        }
        # for It's a Blockade! Achievement
        if = {
            limit = {
                is_player = yes
                NOT = { has_variable = its_a_blockade_happened }
                any_enemy_in_diplo_play = {
                    any_scope_state = {
                        is_blockaded_by = ROOT
                        is_world_market_hub = yes
                        num_world_market_hub_trade_center_levels >= 100
                        blockade_level >= 1
                    }
                }
            }
            set_variable = its_a_blockade_happened
        }
    }
    on_actions = { # delay ensures events won't fire simultaneously
        coup_monthly_events
        delay = { days = 4 }
        garibaldi_monthly_events
        delay = { days = 7 }
        fund_lobbies_monthly_events
        spooky_halloween_events
        delay = { days = 7 }
        tech_monthly_events
    }
}